<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://notes.trangelier.dev/favicon.ico><link rel=stylesheet href=/css/style.min.css><title></title></head><body><header id=banner><p class=title><a href=https://notes.trangelier.dev/>Vimwiki</a></p><nav><ul></ul></nav></header><main id=content><article><header id=post-header><h1></h1></header><h1 id=oracle-linux-debug-container>Oracle Linux Debug Container</h1><p>Runs an Oralce Linux 7 Slim image from dockerhub and destroys it when you detach. Also adds an overide to not inject the Istio sidecar container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl run -i --tty --rm ol8-debug-$USER --image<span style=color:#f92672>=</span>oraclelinux:8 --restart<span style=color:#f92672>=</span>Never <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --annotations<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;sidecar.istio.io/inject=false&#39;</span> --annotations<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;traffic.sidecar.istio.io/excludeOutboundIPRanges=10.96.0.1/32&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -- bash
</span></span></code></pre></div><p>Install the development tools (things like <code>openssl</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum group install <span style=color:#e6db74>&#39;Development Tools&#39;</span>
</span></span></code></pre></div><h1 id=flags>Flags</h1><h2 id=get-just-the-name-of-pods>Get just the name of pods</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>--no-headers -o custom-columns<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;:metadata.name&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Example:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># kubectl get pods --no-headers -o custom-columns=&#34;:metadata.name&#34;</span>
</span></span></code></pre></div><h2 id=find-pods-by-label>Find pods by label</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-l &lt;label&gt;<span style=color:#f92672>=</span>&lt;label-value&gt;
</span></span><span style=display:flex><span><span style=color:#75715e># Example</span>
</span></span><span style=display:flex><span><span style=color:#75715e># kubectl get pods -l app.kubernetes.io/instance=pss-control-plane</span>
</span></span><span style=display:flex><span><span style=color:#75715e># kubectl get pods -l app=incidents-service</span>
</span></span></code></pre></div><h1 id=admission-controllers>Admission Controllers</h1><p>Quoting from the Kubernetes <a href=https://kubernetes.io/docs/admin/admission-controllers/>documentation</a>:</p><blockquote><p>An admission controller is a piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object, but after the request is authenticated and authorized. The controllers [‚Ä¶] are compiled into the kube-apiserver binary, and may only be configured by the cluster administrator. [‚Ä¶] If any of the controllers in either phase reject the request, the entire request is rejected immediately and an error is returned to the end-user.</p></blockquote><p>There are many admission controllers in the Kubernetes core, for example <code>LimitRanger</code> or <code>PodPreset</code>. A complete list is provided <a href=https://kubernetes.io/docs/admin/admission-controllers/#what-does-each-admission-controller-do>here</a>.</p><p><a href=https://docs.oracle.com/en-us/iaas/Content/ContEng/Reference/contengadmissioncontrollers.htm>Oracle OKE Supported Admission Controllers</a> #oci [[oci]]
<a href=https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#validatingadmissionwebhook>Admission Controllers Reference</a> #kubernetes</p><h2 id=podnodeselector>PodNodeSelector</h2><p>Great article going over using PodNodeSelector Admission Controller: <a href=https://www.mgasch.com/2018/01/podnodesel/>https://www.mgasch.com/2018/01/podnodesel/</a></p><p>Ok, so why would I use that one instead of simply specifying <code>NodeSelectors</code> in the pod manifest? Well, using this admission controller has some advantages:</p><ul><li>As the name implies, it enforces node selectors at admission time before creating the pod object</li><li>This puts less pressure on the master components, for example the scheduler; if there is no matching namespace or a conflict, the pod object will not be created</li><li>You can define a default selector for namespaces that have no label selector specified</li><li>Ultimately, it gives the cluster administrator more control over the node selection process (hard enforcement)</li></ul><h1 id=dynamic-admission-control>Dynamic Admission Control</h1><p><a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/>https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/</a></p><blockquote><p>Admission webhooks are HTTP callbacks that receive admission requests and do something with them. You can define two types of admission webhooks, <a href=https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#validatingadmissionwebhook>validating admission webhook</a> and <a href=https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook>mutating admission webhook</a>. Mutating admission webhooks are invoked first, and can modify objects sent to the API server to enforce custom defaults. After all object modifications are complete, and after the incoming object is validated by the API server, validating admission webhooks are invoked and can reject requests to enforce custom policies.</p></blockquote><blockquote><p><strong>Note</strong>: Admission webhooks that need to guarantee they see the final state of the object in order to enforce policy should use a validating admission webhook, since objects can be modified after being seen by mutating webhooks.</p></blockquote><h2 id=types-of-dynamic-admission-control-webhooks>Types of Dynamic Admission Control Webhooks</h2><h3 id=mutating-admissions-webhook>Mutating Admissions Webhook</h3><p>Mutating admission webhooks are invoked first, and can modify objects sent to the API server to enforce custom defaults. After all object modifications are complete, and after the incoming object is validated by the API server, validating admission webhooks are invoked and can reject requests to enforce custom policies.</p><h3 id=validating-admission-webhook>Validating Admission Webhook</h3><p>Validates the state of the resource before it is invoked by the API server. This is how you can <strong>validate</strong> and <strong>enforce</strong> that resources meet custom criteria.</p><h2 id=references>References</h2><ul><li><a href=https://www.baeldung.com/java-kubernetes-admission-controller#sample_user_case>https://www.baeldung.com/java-kubernetes-admission-controller#sample_user_case</a><ul><li>Good ole Baeldung showing how to do it in Spring Boot üëè</li></ul></li></ul><h1 id=virtual-nodes>Virtual Nodes</h1><p><a href=https://blogs.oracle.com/cloud-infrastructure/post/first-principles-making-kubernetes-serverless-with-oci-virtual-nodes>https://blogs.oracle.com/cloud-infrastructure/post/first-principles-making-kubernetes-serverless-with-oci-virtual-nodes</a>
<a href=https://blogs.oracle.com/cloud-infrastructure/post/oke-virtual-nodes-deliver-serverless-experience>https://blogs.oracle.com/cloud-infrastructure/post/oke-virtual-nodes-deliver-serverless-experience</a></p><h1 id=kubernetes-on-lxc-container>Kubernetes on LXC Container</h1><p><a href=https://gist.github.com/triangletodd/02f595cd4c0dc9aac5f7763ca2264185>https://gist.github.com/triangletodd/02f595cd4c0dc9aac5f7763ca2264185</a></p></article></main><footer id=footer></footer></body></html>